import{r as m,a as O,j as e,H as U,L as G}from"./app-MhIMGnYS.js";import{F as H,A as T}from"./AdminLayout-B9gqaFNo.js";import{P as N}from"./PrimaryButton-CS5AC7K3.js";import{M as W,S as $}from"./SecondaryButton-BUX9d8HU.js";import{I as l}from"./InputLabel-BlNU_lCG.js";import{T as h}from"./TextInput-CzDui5v1.js";import{I as c}from"./InputError-mD4U0iqA.js";import{D as z}from"./DishCard-CuwJ7EYw.js";import"./ApplicationLogo-ohDFeeZl.js";import"./logoWhite-C0-n3M0p.js";import"./NewspaperIcon-DhAzDRSk.js";import"./MapIcon-BK3SkOGS.js";import"./Dropdown-DY1x7qXL.js";import"./transition-8hVcBnh1.js";import"./index-Cff_kebv.js";import"./TrashIcon-BZ3YAk3j.js";function V({restaurant:u,foodCategories:y}){const r=u.data,w=m.useRef(null),{data:a,setData:d,post:_,processing:D,errors:o,isDirty:C}=O({_method:"PATCH",name:r.name||"",address:r.address||"",description:r.description||"",food_category_id:r.food_category.id||"",images:[],images_to_delete:[],dishes:r.dishes.map(s=>({id:s.id,name:s.name,image:s.image_url})),dishes_to_delete:[]}),[q,I]=m.useState([]),R=m.useRef(null),F=s=>{const i=Array.from(s);d("images",[...a.images,...i]);const b=i.map(g=>URL.createObjectURL(g));I(g=>[...g,...b])},E=s=>{d("images_to_delete",[...a.images_to_delete,s])},[n,x]=m.useState({name:"",image:null}),j=m.useRef(null),P=()=>{if(!n.name.trim()||!n.image){alert("Por favor, completa el nombre y la imagen del plato.");return}d("dishes",[...a.dishes,n]),x({name:"",image:null}),j.current&&(j.current.value="")},[k,v]=m.useState(!1),[t,f]=m.useState({index:null,data:{}}),A=m.useRef(null),L=(s,i)=>{f({index:i,data:{...s}}),v(!0)},p=()=>v(!1),M=()=>{const s=[...a.dishes];s[t.index]={...t.data,_isDirty:!0},d("dishes",s),p()},S=s=>{const i=a.dishes[s];i.id&&d("dishes_to_delete",[...a.dishes_to_delete,i.id]),d("dishes",a.dishes.filter((b,g)=>g!==s))},B=s=>{s.preventDefault(),_(route("admin.restaurants.update",r.slug),{forceFormData:!0})};return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:`Editar: ${r.name}`}),e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-smd-dark",children:"Información del Restaurante"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"name",value:"Nombre"}),e.jsx(h,{id:"name",value:a.name,onChange:s=>d("name",s.target.value),className:"w-full mt-1"}),e.jsx(c,{message:o.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"food_category_id",value:"Categoría"}),e.jsx("select",{id:"food_category_id",value:a.food_category_id,onChange:s=>d("food_category_id",s.target.value),className:"w-full mt-1 border-gray-300 rounded-md shadow-sm",children:y.data.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))}),e.jsx(c,{message:o.food_category_id,className:"mt-2"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(l,{htmlFor:"address",value:"Dirección"}),e.jsx(h,{id:"address",value:a.address,onChange:s=>d("address",s.target.value),className:"w-full mt-1"}),e.jsx(c,{message:o.address,className:"mt-2"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(l,{htmlFor:"description",value:"Descripción"}),e.jsx("textarea",{id:"description",value:a.description,onChange:s=>d("description",s.target.value),rows:"4",className:"w-full mt-1 border-gray-300 rounded-md shadow-sm"}),e.jsx(c,{message:o.description,className:"mt-2"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-smd-dark",children:"Galería de Imágenes"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-6",children:r.images.filter(s=>!a.images_to_delete.includes(s.id)).map(s=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s.url,className:"w-full h-32 object-cover rounded-md",alt:s.name}),e.jsx("button",{type:"button",onClick:()=>E(s.id),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(H,{className:"h-5 w-5"})})]},s.id))}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"gallery_images",value:"Añadir nuevas imágenes (WEBP, <1MB)"}),e.jsx("input",{ref:R,id:"gallery_images",type:"file",multiple:!0,accept:"image/webp",onChange:s=>F(s.target.files),className:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-smd-soft-green/10 file:text-smd-soft-green hover:file:bg-smd-soft-green/20"})]}),e.jsx(c,{message:o.images,className:"mt-2"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-smd-dark",children:"Platos Destacados"}),e.jsxs("div",{className:"p-4 border-dashed border-2 rounded-md mb-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"newDishName",value:"Nombre del Plato"}),e.jsx(h,{id:"newDishName",type:"text",value:n.name,onChange:s=>x({...n,name:s.target.value}),className:"w-full mt-1"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"newDishImage",value:"Imagen (WEBP, <1MB)"}),e.jsx("input",{ref:w,id:"newDishImage",type:"file",accept:"image/webp",onChange:s=>x({...n,image:s.target.files[0]}),className:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-smd-soft-green/10 file:text-smd-soft-green hover:file:bg-smd-soft-green/20"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{type:"button",onClick:P,className:"bg-smd-dark text-white px-4 py-2 rounded-md font-semibold text-sm hover:bg-gray-700 transition-colors",children:"Añadir Plato"})})]}),e.jsxs("h3",{className:"text-lg font-medium text-gray-600 mb-4",children:["Platos Actuales: ",a.dishes.length]}),e.jsx("div",{className:"space-y-4",children:a.dishes.map((s,i)=>e.jsx(z,{dish:s,onRemove:()=>S(i,s.id),onEdit:()=>L(s,i)},s.id||`new-${i}`))}),Object.keys(o).filter(s=>s.startsWith("dishes.")).map(s=>e.jsx(c,{message:o[s],className:"mt-2"},s))]}),e.jsxs("div",{className:"mt-6 flex justify-end items-center gap-smd-16",children:[e.jsx(G,{href:route("admin.restaurants.index"),className:"inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50",children:"Cancelar"}),e.jsx(N,{className:"px-6 py-2 bg-smd-soft-green text-white font-bold rounded-lg hover:bg-green-700 disabled:bg-gray-400",disabled:D||!C,children:"Actualizar Restaurante"})]})]}),e.jsx(W,{show:k,onClose:p,children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Editar Plato"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"editDishName",value:"Nombre del Plato"}),e.jsx(h,{id:"editDishName",value:t.data.name,onChange:s=>f({...t,data:{...t.data,name:s.target.value}}),className:"w-full mt-1"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"editDishImage",value:"Cambiar Imagen (Opcional)"}),e.jsx("input",{ref:A,id:"editDishImage",type:"file",accept:"image/webp",onChange:s=>f({...t,data:{...t.data,image:s.target.files[0]}}),className:"mt-1 block w-full text-sm ..."})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Vista Previa:"}),e.jsx("img",{src:typeof t.data.image=="string"?t.data.image:t.data.image?URL.createObjectURL(t.data.image):"",className:"w-24 h-24 object-cover rounded-md mt-1 border"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx($,{onClick:p,children:"Cancelar"}),e.jsx(N,{onClick:M,className:"ms-3",children:"Guardar Cambios"})]})]})})]})}V.layout=u=>e.jsx(T,{children:u,title:"Editar:"});export{V as default};

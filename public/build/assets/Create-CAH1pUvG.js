import{a as k,r as m,R as A,j as s,H as P}from"./app-DzygFBgl.js";import{A as O}from"./AdminLayout-iSWlODYX.js";import{S as B}from"./react-select.esm-CmEbiFLy.js";import{C as L}from"./react-select-creatable.esm-CUNEghV2.js";import{P as f}from"./PrimaryButton-CD2XSNjt.js";import{M as T,S as $}from"./SecondaryButton-BEXQKAn0.js";import{I as r}from"./InputLabel-tgVCl6Fl.js";import{T as d}from"./TextInput-Cx69Y94c.js";import{I as u}from"./InputError-pd-svykG.js";import{S as q}from"./SubeventCard-hvHoG6oN.js";import{D as G}from"./DragImage-BQaEqD69.js";import"./ApplicationLogo-D4_4GEX-.js";import"./logoWhite-BzQEmrQ3.js";import"./logo-bjrkIz94.js";import"./NewspaperIcon-Cyn0aHbl.js";import"./MapIcon-Cy3WWzkZ.js";import"./Dropdown-CoU3w6-g.js";import"./transition-ycl7RwyR.js";import"./Select-ef7c0426.esm-nxTyUWt2.js";import"./index-mEwdjoWP.js";import"./TrashIcon-CRhKlpBw.js";function H({eventCategories:v,tags:j}){const{data:a,setData:l,post:_,processing:N,errors:o,transform:S}=k({name:"",description:"",starts_at:"",finishes_at:"",event_category_id:"",image:null,subevents:[]}),[y,p]=m.useState(!1),[W,V]=m.useState(!1);A.useRef(null);const[z,J]=m.useState(null),[x,g]=m.useState(null),[t,i]=m.useState({name:"",description:"",date:"",duration:"",image:null,tags:[]}),E=m.useRef(null),w=v.data.map(e=>({value:e.id,label:e.name})),h=j.data.map(e=>({value:e.id,label:e.name,color:e.color}));m.useEffect(()=>{S(e=>({...e,subevents:e.subevents.map(n=>({...n,tags:n.tags.map(c=>c.value||c)}))}))},[a.subevents]);const C=m.useMemo(()=>[...a.subevents].sort((e,n)=>new Date(e.date)-new Date(n.date)),[a.subevents]),F=()=>{g(null),i({name:"",description:"",date:"",duration:"",image:null,tags:[]}),p(!0)},I=e=>{g(e),i(a.subevents[e]),p(!0)},b=()=>p(!1),D=()=>{if(x!==null){const e=[...a.subevents];e[x]=t,l("subevents",e)}else l("subevents",[...a.subevents,t]);b()},M=e=>{confirm("¿Estás seguro de que quieres eliminar este subevento?")&&l("subevents",a.subevents.filter((n,c)=>c!==e))},R=e=>{e.preventDefault(),_(route("admin.events.store"),{forceFormData:!0,preserveScroll:!0})};return s.jsxs(s.Fragment,{children:[s.jsx(P,{title:"Crear Evento"}),s.jsxs("form",{onSubmit:R,className:"space-y-6",children:[s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4 text-smd-dark",children:"Información del Evento"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"md:col-span-2",children:[s.jsx(r,{htmlFor:"name",value:"Nombre del Evento"}),s.jsx(d,{id:"name",value:a.name,onChange:e=>l("name",e.target.value),className:"w-full mt-1"}),s.jsx(u,{message:o.name,className:"mt-2"})]}),s.jsxs("div",{children:[s.jsx(r,{htmlFor:"starts_at",value:"Fecha de Inicio"}),s.jsx(d,{id:"starts_at",type:"date",value:a.starts_at,onChange:e=>l("starts_at",e.target.value),className:"w-full mt-1"}),s.jsx(u,{message:o.starts_at,className:"mt-2"})]}),s.jsxs("div",{children:[s.jsx(r,{htmlFor:"finishes_at",value:"Fecha de Fin"}),s.jsx(d,{id:"finishes_at",type:"date",value:a.finishes_at,onChange:e=>l("finishes_at",e.target.value),className:"w-full mt-1"}),s.jsx(u,{message:o.finishes_at,className:"mt-2"})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx(r,{htmlFor:"description",value:"Descripción"}),s.jsx("textarea",{id:"description",value:a.description,onChange:e=>l("description",e.target.value),rows:"4",className:"w-full mt-1 border-gray-300 rounded-md"}),s.jsx(u,{message:o.description,className:"mt-2"})]}),s.jsxs("div",{children:[s.jsx(r,{htmlFor:"event_category_id",value:"Categoría del Evento"}),s.jsx(B,{id:"event_category_id",options:w,onChange:e=>l("event_category_id",e.value),className:"mt-1"}),s.jsx(u,{message:o.event_category_id,className:"mt-2"})]}),s.jsx(G,{setData:l,errors:o})]})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:"text-xl font-semibold text-smd-dark",children:"Subeventos (Línea de Tiempo)"}),s.jsx("button",{type:"button",onClick:F,className:"bg-smd-dark text-white px-4 py-2 rounded-md font-semibold text-sm hover:bg-gray-700",children:"Añadir Subevento"})]}),s.jsx("div",{className:"space-y-4",children:C.map((e,n)=>s.jsx(q,{subevent:e,onRemove:()=>M(n),onEdit:()=>I(n)},n))}),a.subevents.length===0&&s.jsx("p",{className:"text-center text-gray-500 py-4 border-dashed border-2 rounded-md",children:"Aún no hay subeventos añadidos."}),Object.keys(o).filter(e=>e.startsWith("subevents.")).map(e=>s.jsx(u,{message:o[e],className:"mt-2"},e))]}),s.jsx("div",{className:"flex justify-end gap-4",children:s.jsx(f,{disabled:N,children:"Guardar Evento"})})]}),s.jsx(T,{show:y,onClose:b,children:s.jsxs("div",{className:"p-6",children:[s.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:[x!==null?"Editar":"Crear"," Subevento"]}),s.jsxs("div",{className:"mt-4 space-y-4",children:[s.jsx(r,{htmlFor:"sub_name",value:"Nombre"}),s.jsx(d,{id:"sub_name",value:t.name,onChange:e=>i({...t,name:e.target.value}),className:"w-full"}),s.jsx(r,{htmlFor:"sub_date",value:"Fecha"}),s.jsx(d,{id:"sub_date",type:"date",value:t.date,onChange:e=>i({...t,date:e.target.value}),className:"w-full"}),s.jsx(r,{htmlFor:"sub_duration",value:"Duración (ej. 2 horas, 8:00 PM)"}),s.jsx(d,{id:"sub_duration",value:t.duration,onChange:e=>i({...t,duration:e.target.value}),className:"w-full"}),s.jsx(r,{htmlFor:"sub_description",value:"Descripción"}),s.jsx("textarea",{id:"sub_description",value:t.description,onChange:e=>i({...t,description:e.target.value}),rows:"3",className:"w-full mt-1 border-gray-300 rounded-md"}),s.jsx(r,{htmlFor:"sub_image",value:"Imagen (WEBP, <1MB)"}),s.jsx("input",{id:"sub_image",type:"file",accept:"image/webp",ref:E,onChange:e=>i({...t,image:e.target.files[0]}),className:"mt-1 block w-full text-sm ... file:..."}),s.jsx(r,{htmlFor:"sub_tags",value:"Tags"}),s.jsx(L,{isMulti:!0,options:h,defaultValue:t.tags.map(e=>typeof e=="object"?e:h.find(n=>n.value===e)||{value:e,label:e,__isNew__:!0}),onChange:e=>i({...t,tags:e||[]}),formatCreateLabel:e=>`Añadir tag "${e}"`})]}),s.jsxs("div",{className:"mt-6 flex justify-end",children:[s.jsx($,{onClick:b,children:"Cancelar"}),s.jsx(f,{onClick:D,className:"ms-3",children:"Guardar Subevento"})]})]})})]})}H.layout=v=>s.jsx(O,{children:v,title:"Crear Evento"});export{H as default};

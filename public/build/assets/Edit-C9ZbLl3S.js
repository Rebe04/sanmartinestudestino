import{r as m,a as L,j as t,H as R}from"./app-DzygFBgl.js";import{A as $}from"./AdminLayout-iSWlODYX.js";import{S as H}from"./react-select.esm-CmEbiFLy.js";import{C as q}from"./react-select-creatable.esm-CUNEghV2.js";import{I as r}from"./InputLabel-tgVCl6Fl.js";import{T as u}from"./TextInput-Cx69Y94c.js";import{I as c}from"./InputError-pd-svykG.js";import{M as W,S as z}from"./SecondaryButton-BEXQKAn0.js";import{P as j}from"./PrimaryButton-CD2XSNjt.js";import{D as G}from"./DragImage-BQaEqD69.js";import{S as V}from"./SubeventCard-hvHoG6oN.js";import"./ApplicationLogo-D4_4GEX-.js";import"./logoWhite-BzQEmrQ3.js";import"./logo-bjrkIz94.js";import"./NewspaperIcon-Cyn0aHbl.js";import"./MapIcon-Cy3WWzkZ.js";import"./Dropdown-CoU3w6-g.js";import"./transition-ycl7RwyR.js";import"./Select-ef7c0426.esm-nxTyUWt2.js";import"./index-mEwdjoWP.js";import"./TrashIcon-CRhKlpBw.js";function pe({event:_,eventCategories:y,tags:N}){const l=_.data,[S,J]=m.useState(l.image_url),{data:a,setData:i,post:w,processing:E,errors:o,transform:C}=L({_method:"PATCH",name:l.name||"",description:l.description||"",starts_at:l.starts_at||"",finishes_at:l.finishes_at||"",event_category_id:l.event_category.id||"",image:null,image_delete:!1,subevents:l.subevents.map(e=>({id:e.id,name:e.name,description:e.description,date:e.date,duration:e.duration,image:e.image_url,tags:e.tags.map(s=>({value:s.id,label:s.name,color:s.color}))})),subevents_to_delete:[]});m.useEffect(()=>{C(e=>({...e,subevents:e.subevents.map(s=>({...s,tags:s.tags.map(b=>b.value||b),image:typeof s.image=="object"&&s.image!==null?s.image:null}))}))},[a.subevents]);const[F,v]=m.useState(!1),[g,x]=m.useState(null),[n,d]=m.useState({name:"",description:"",date:"",duration:"",image:null,tags:[]}),D=m.useRef(null),h=y.data.map(e=>({value:e.id,label:e.name})),I=h.find(e=>e.value===a.event_category_id),f=N.data.map(e=>({value:e.id,label:e.name,color:e.color})),M=m.useMemo(()=>[...a.subevents].sort((e,s)=>new Date(e.date)-new Date(s.date)),[a.subevents]),P=()=>{x(null),d({name:"",description:"",date:"",duration:"",image:null,tags:[]}),v(!0)},k=e=>{x(e),d(a.subevents[e]),v(!0)},p=()=>v(!1),A=()=>{const e={...n,_isDirty:!0};if(g!==null){const s=[...a.subevents];s[g]=e,i("subevents",s)}else i("subevents",[...a.subevents,e]);p()},O=e=>{if(confirm("¿Estás seguro de que quieres eliminar este subevento?")){const s=a.subevents[e];s.id&&i("subevents_to_delete",[...a.subevents_to_delete,s.id]),i("subevents",a.subevents.filter((b,B)=>B!==e))}},T=e=>{e.preventDefault(),w(route("admin.events.update",l.slug),{forceFormData:!0,preserveScroll:!0})};return t.jsxs($,{children:[t.jsx(R,{title:`Editar: ${l.name}`}),t.jsxs("form",{onSubmit:T,className:"space-y-6",children:[t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"Información del Evento"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"md:col-span-2",children:[t.jsx(r,{htmlFor:"name",value:"Nombre del Evento"}),t.jsx(u,{id:"name",value:a.name,onChange:e=>i("name",e.target.value),className:"w-full mt-1"}),t.jsx(c,{message:o.name,className:"mt-2"})]}),t.jsxs("div",{children:[t.jsx(r,{htmlFor:"starts_at",value:"Fecha de Inicio"}),t.jsx(u,{id:"starts_at",type:"date",value:a.starts_at,onChange:e=>i("starts_at",e.target.value),className:"w-full mt-1"}),t.jsx(c,{message:o.starts_at,className:"mt-2"})]}),t.jsxs("div",{children:[t.jsx(r,{htmlFor:"finishes_at",value:"Fecha de Fin"}),t.jsx(u,{id:"finishes_at",type:"date",value:a.finishes_at,onChange:e=>i("finishes_at",e.target.value),className:"w-full mt-1"}),t.jsx(c,{message:o.finishes_at,className:"mt-2"})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx(r,{htmlFor:"description",value:"Descripción"}),t.jsx("textarea",{id:"description",value:a.description,onChange:e=>i("description",e.target.value),rows:"4",className:"w-full mt-1 border-gray-300 rounded-md"}),t.jsx(c,{message:o.description,className:"mt-2"})]}),t.jsxs("div",{children:[t.jsx(r,{htmlFor:"event_category_id",value:"Categoría del Evento"}),t.jsx(H,{id:"event_category_id",options:h,value:I,onChange:e=>i("event_category_id",e.value),className:"mt-1",classNamePrefix:"select"}),t.jsx(c,{message:o.event_category_id,className:"mt-2"})]}),t.jsx(G,{imagePreviewData:S,errors:o,setData:i})]})]}),t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-semibold text-smd-dark",children:"Subeventos (Línea de Tiempo)"}),t.jsx("button",{type:"button",onClick:P,className:"bg-smd-dark text-white px-4 py-2 rounded-md font-semibold text-sm hover:bg-gray-700",children:"Añadir Subevento"})]}),t.jsx("div",{className:"space-y-4",children:M.map((e,s)=>t.jsx(V,{subevent:e,onRemove:()=>O(s),onEdit:()=>k(s)},s))}),a.subevents.length===0&&t.jsx("p",{className:"text-center text-gray-500 py-4 border-dashed border-2 rounded-md",children:"Aún no hay subeventos añadidos."}),Object.keys(o).filter(e=>e.startsWith("subevents.")).map(e=>t.jsx(c,{message:o[e],className:"mt-2"},e))]}),t.jsx("div",{className:"flex justify-end gap-4",children:t.jsx(j,{className:"px-6 py-2 bg-smd-soft-green text-white font-bold rounded-lg hover:bg-green-700 disabled:bg-gray-400",disabled:E,children:"Actualizar Evento"})})]}),t.jsx(W,{show:F,onClose:p,children:t.jsxs("div",{className:"p-6",children:[t.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:[g!==null?"Editar":"Crear"," Subevento"]}),t.jsxs("div",{className:"mt-4 space-y-4",children:[t.jsx(r,{htmlFor:"sub_name",value:"Nombre"}),t.jsx(u,{id:"sub_name",value:n.name,onChange:e=>d({...n,name:e.target.value}),className:"w-full"}),t.jsx(r,{htmlFor:"sub_date",value:"Fecha"}),t.jsx(u,{id:"sub_date",type:"date",value:n.date,onChange:e=>d({...n,date:e.target.value}),className:"w-full"}),t.jsx(r,{htmlFor:"sub_duration",value:"Duración (ej. 2 horas, 8:00 PM)"}),t.jsx(u,{id:"sub_duration",value:n.duration,onChange:e=>d({...n,duration:e.target.value}),className:"w-full"}),t.jsx(r,{htmlFor:"sub_description",value:"Descripción"}),t.jsx("textarea",{id:"sub_description",value:n.description,onChange:e=>d({...n,description:e.target.value}),rows:"3",className:"w-full mt-1 border-gray-300 rounded-md"}),t.jsx(r,{htmlFor:"sub_image",value:"Imagen (WEBP, <1MB)"}),t.jsx("input",{id:"sub_image",type:"file",accept:"image/webp",ref:D,onChange:e=>d({...n,image:e.target.files[0]}),className:"mt-1 block w-full text-sm ... file:..."}),t.jsx(r,{htmlFor:"sub_tags",value:"Tags"}),t.jsx(q,{isMulti:!0,options:f,defaultValue:n.tags.map(e=>typeof e=="object"?e:f.find(s=>s.value===e)||{value:e,label:e,__isNew__:!0}),onChange:e=>d({...n,tags:e||[]}),formatCreateLabel:e=>`Añadir tag "${e}"`})]}),t.jsxs("div",{className:"mt-6 flex justify-end gap-smd-8",children:[t.jsx(z,{className:"inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50",onClick:p,children:"Cancelar"}),t.jsx(j,{onClick:A,className:"px-6 py-2 bg-smd-soft-green text-white font-bold rounded-lg hover:bg-green-700 disabled:bg-gray-400",children:"Guardar Subevento"})]})]})})]})}export{pe as default};

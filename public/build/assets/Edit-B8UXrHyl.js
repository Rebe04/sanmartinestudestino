import{r as m,u as L,j as s,H as R}from"./app-23aZrtaW.js";import{A as $}from"./AdminLayout-BaNJbCUY.js";import{S as H}from"./react-select.esm-aUfJC__a.js";import{C as q}from"./react-select-creatable.esm-Bdc-qCLG.js";import{I as r}from"./InputLabel-DVPVd5fy.js";import{T as u}from"./TextInput-CJxWu18G.js";import{I as c}from"./InputError-ksqCU8nR.js";import{M as W,S as z}from"./SecondaryButton-Q3SI3VNH.js";import{P as j}from"./PrimaryButton-VcKEfINT.js";import{D as G}from"./DragImage-mOvZD5nG.js";import{S as V}from"./SubeventCard-BJw0uLFp.js";import"./ApplicationLogo-D-kKVd4A.js";import"./logoWhite-C0-n3M0p.js";import"./NewspaperIcon-F11gz-j-.js";import"./MapIcon-ZO0o0V-p.js";import"./Dropdown-_YoY5Am2.js";import"./transition-D30kd9CN.js";import"./Select-ef7c0426.esm-BIMYpt9T.js";import"./index-bKaOaWek.js";import"./TrashIcon-Br41WAcc.js";function ge({event:_,eventCategories:y,tags:N}){const l=_.data,[S,J]=m.useState(l.image_url),{data:a,setData:i,post:w,processing:E,errors:o,transform:C}=L({_method:"PATCH",name:l.name||"",description:l.description||"",starts_at:l.starts_at||"",finishes_at:l.finishes_at||"",event_category_id:l.event_category.id||"",image:null,image_delete:!1,subevents:l.subevents.map(e=>({id:e.id,name:e.name,description:e.description,date:e.date,duration:e.duration,image:e.image_url,tags:e.tags.map(t=>({value:t.id,label:t.name,color:t.color}))})),subevents_to_delete:[]});m.useEffect(()=>{C(e=>({...e,subevents:e.subevents.map(t=>({...t,tags:t.tags.map(b=>b.value||b),image:typeof t.image=="object"&&t.image!==null?t.image:null}))}))},[a.subevents]);const[F,v]=m.useState(!1),[g,x]=m.useState(null),[n,d]=m.useState({name:"",description:"",date:"",duration:"",image:null,tags:[]}),D=m.useRef(null),h=y.data.map(e=>({value:e.id,label:e.name})),I=h.find(e=>e.value===a.event_category_id),f=N.data.map(e=>({value:e.id,label:e.name,color:e.color})),M=m.useMemo(()=>[...a.subevents].sort((e,t)=>new Date(e.date)-new Date(t.date)),[a.subevents]),P=()=>{x(null),d({name:"",description:"",date:"",duration:"",image:null,tags:[]}),v(!0)},k=e=>{x(e),d(a.subevents[e]),v(!0)},p=()=>v(!1),A=()=>{const e={...n,_isDirty:!0};if(g!==null){const t=[...a.subevents];t[g]=e,i("subevents",t)}else i("subevents",[...a.subevents,e]);p()},O=e=>{if(confirm("¿Estás seguro de que quieres eliminar este subevento?")){const t=a.subevents[e];t.id&&i("subevents_to_delete",[...a.subevents_to_delete,t.id]),i("subevents",a.subevents.filter((b,B)=>B!==e))}},T=e=>{e.preventDefault(),w(route("admin.events.update",l.slug),{forceFormData:!0,preserveScroll:!0})};return s.jsxs($,{children:[s.jsx(R,{title:`Editar: ${l.name}`}),s.jsxs("form",{onSubmit:T,className:"space-y-6",children:[s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[s.jsx("h2",{className:"text-xl font-semibold",children:"Información del Evento"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"md:col-span-2",children:[s.jsx(r,{htmlFor:"name",value:"Nombre del Evento"}),s.jsx(u,{id:"name",value:a.name,onChange:e=>i("name",e.target.value),className:"w-full mt-1"}),s.jsx(c,{message:o.name,className:"mt-2"})]}),s.jsxs("div",{children:[s.jsx(r,{htmlFor:"starts_at",value:"Fecha de Inicio"}),s.jsx(u,{id:"starts_at",type:"date",value:a.starts_at,onChange:e=>i("starts_at",e.target.value),className:"w-full mt-1"}),s.jsx(c,{message:o.starts_at,className:"mt-2"})]}),s.jsxs("div",{children:[s.jsx(r,{htmlFor:"finishes_at",value:"Fecha de Fin"}),s.jsx(u,{id:"finishes_at",type:"date",value:a.finishes_at,onChange:e=>i("finishes_at",e.target.value),className:"w-full mt-1"}),s.jsx(c,{message:o.finishes_at,className:"mt-2"})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx(r,{htmlFor:"description",value:"Descripción"}),s.jsx("textarea",{id:"description",value:a.description,onChange:e=>i("description",e.target.value),rows:"4",className:"w-full mt-1 border-gray-300 rounded-md"}),s.jsx(c,{message:o.description,className:"mt-2"})]}),s.jsxs("div",{children:[s.jsx(r,{htmlFor:"event_category_id",value:"Categoría del Evento"}),s.jsx(H,{id:"event_category_id",options:h,value:I,onChange:e=>i("event_category_id",e.value),className:"mt-1",classNamePrefix:"select"}),s.jsx(c,{message:o.event_category_id,className:"mt-2"})]}),s.jsx(G,{imagePreviewData:S,errors:o,setData:i})]})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:"text-xl font-semibold text-smd-dark",children:"Subeventos (Línea de Tiempo)"}),s.jsx("button",{type:"button",onClick:P,className:"bg-smd-dark text-white px-4 py-2 rounded-md font-semibold text-sm hover:bg-gray-700",children:"Añadir Subevento"})]}),s.jsx("div",{className:"space-y-4",children:M.map((e,t)=>s.jsx(V,{subevent:e,onRemove:()=>O(t),onEdit:()=>k(t)},t))}),a.subevents.length===0&&s.jsx("p",{className:"text-center text-gray-500 py-4 border-dashed border-2 rounded-md",children:"Aún no hay subeventos añadidos."}),Object.keys(o).filter(e=>e.startsWith("subevents.")).map(e=>s.jsx(c,{message:o[e],className:"mt-2"},e))]}),s.jsx("div",{className:"flex justify-end gap-4",children:s.jsx(j,{className:"px-6 py-2 bg-smd-soft-green text-white font-bold rounded-lg hover:bg-green-700 disabled:bg-gray-400",disabled:E,children:"Actualizar Evento"})})]}),s.jsx(W,{show:F,onClose:p,children:s.jsxs("div",{className:"p-6",children:[s.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:[g!==null?"Editar":"Crear"," Subevento"]}),s.jsxs("div",{className:"mt-4 space-y-4",children:[s.jsx(r,{htmlFor:"sub_name",value:"Nombre"}),s.jsx(u,{id:"sub_name",value:n.name,onChange:e=>d({...n,name:e.target.value}),className:"w-full"}),s.jsx(r,{htmlFor:"sub_date",value:"Fecha"}),s.jsx(u,{id:"sub_date",type:"date",value:n.date,onChange:e=>d({...n,date:e.target.value}),className:"w-full"}),s.jsx(r,{htmlFor:"sub_duration",value:"Duración (ej. 2 horas, 8:00 PM)"}),s.jsx(u,{id:"sub_duration",value:n.duration,onChange:e=>d({...n,duration:e.target.value}),className:"w-full"}),s.jsx(r,{htmlFor:"sub_description",value:"Descripción"}),s.jsx("textarea",{id:"sub_description",value:n.description,onChange:e=>d({...n,description:e.target.value}),rows:"3",className:"w-full mt-1 border-gray-300 rounded-md"}),s.jsx(r,{htmlFor:"sub_image",value:"Imagen (WEBP, <1MB)"}),s.jsx("input",{id:"sub_image",type:"file",accept:"image/webp",ref:D,onChange:e=>d({...n,image:e.target.files[0]}),className:"mt-1 block w-full text-sm ... file:..."}),s.jsx(r,{htmlFor:"sub_tags",value:"Tags"}),s.jsx(q,{isMulti:!0,options:f,defaultValue:n.tags.map(e=>typeof e=="object"?e:f.find(t=>t.value===e)||{value:e,label:e,__isNew__:!0}),onChange:e=>d({...n,tags:e||[]}),formatCreateLabel:e=>`Añadir tag "${e}"`})]}),s.jsxs("div",{className:"mt-6 flex justify-end gap-smd-8",children:[s.jsx(z,{className:"inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50",onClick:p,children:"Cancelar"}),s.jsx(j,{onClick:A,className:"px-6 py-2 bg-smd-soft-green text-white font-bold rounded-lg hover:bg-green-700 disabled:bg-gray-400",children:"Guardar Subevento"})]})]})})]})}export{ge as default};
